{% extends "base2.html" %}
{% block app_content %}

<link rel="stylesheet" href="/static/index_y_remove_device.css">
<link rel="stylesheet" href="/static/style_slider.css">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"> <!-- arregla el tema del zoom en el modal, la romi toda -->


{% for k,v in devices.items()|sort: %}
   <button class="dropdown-btn index" data-toggle="collapse" id="dpdw{{k}}"> {{k}} <i class="glyphicon glyphicon-triangle-bottom" style="font-size: 20px" aria-hidden="true"></i></button>
   <div class="dropdown-container-pitu collapse " >
    	
    {% for kk,vv in v.items()|sort: %}
    	
	    	  <div class="row" id="{{k}}-{{kk.split(' ')[0]}}.{{kk.split(' ')[1]}}">
	          <div class="col-xs-10 " style="display: flex;justify-content: flex-start;padding-left: 15px;">
	                          
	                          <h3 id="textoreloco" style="vertical-align: text-top;margin-top: 5px;padding-left: 20px;"> {{kk}}</h3>
	                          
	          </div>
            <div class="col-xs-2" style="display: flex;justify-content: flex-end;padding-right: 0px;padding-top: 9px;">

              <span class="glyphicon glyphicon-menu-right editdevice" onclick='' data-location="{{k}}" data-str_id="{{kk}}" data-state="{{vv.State}}" data-set_point="{{vv.set_point}}" data-dev_type="{{vv.dev_type}}" ></span>
	  </div>
    	</div>
    {%endfor%}
  </div>
    {%endfor%}




    <div class="modal fade" id="modaleditdevice" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="margin-top: 60px;">
            <!-- Modal Header -->
            <div class="modal-header">
                <button type="button" class="close"
                   data-dismiss="modal">
                       <span aria-hidden="true">&times;</span>
                       <span class="sr-only">Close</span>
                </button>
                <center><h4 class="modal-title" id="myModalLabel">Edit Device</h4></center>
            </div>

            <!-- Modal Body -->
       <div class="modal-body">
                
                <form role="form" action="" method="POST" id="form_id">
                  <div class="form-group">
                    <label for="device_location">Location</label>
                      <input type="text" class="form-control" id="device_location" name="location"/>
                  </div>

                  <div class="form-group">
                    <label for="device_name">Name</label>
                      <input type="text" class="form-control" id="device_name" name="name"/>
                  </div>

                  <div class="form-group" style="display: none;" > <input type="text" id="dataplacer" name="dataplace" data-dev_type="" ></div>

                <div class="row">
                          <div class="col-xs-6" style="display: flex;justify-content: flex-start;padding-left: 20px;">
                                  
                                 <h5 id="textoreloco" style="vertical-align: text-top;margin-top: 5px;">  <b>On/Off</b></h5>
                                  
                          </div>

                            <div class="col-xs-6" style="display: flex;justify-content: flex-end;" >
                              <div class="onoffswitch">
                                <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" value="Off" >
                                <label class="onoffswitch-label" for="myonoffswitch"></label>
                              </div>
                            </div>
                  </div>

                  <div class="row" id="prendeapaga" style="display:none;padding-left: 20px;">
                        <form action="" method="POST" style="padding-left: 15px;"> <!---On submit, send the form-data to a file named "/setparameters" (to process the input):-->
                              <div class="form-group">
                                          <input type="text" style="display:none;"  id="statevalue" name="statevalue" value="0">
                                          <div class="row">
                                                <div class="col-xs-9">
                                                  <div class="slidecontainer" style="padding-top: 26px;">
                                                      <input type="range" min="0" max="100" step="5" value="0" class="slider" id="myRange" name="set_point">
                                                  </div>
                                                </div>
                                                <div class="col-xs-3" style="display: flex;justify-content: center;">
                                                    <b><h3><span id="demo"></span>%</h3></b> 
                                                </div>
                                        </div>

                            </div>
                    </form>
                  </div>
                  <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                  <button type="submit" id="submit_changes" class="btn btn-primary" >Save Changes</button>
                </form>
              </div>





        </div>
    </div>
</div>

    <script type="text/javascript">

    var slider = document.getElementById("myRange");
    var output = document.getElementById("demo");
    output.innerHTML = slider.value;

    slider.oninput = function() { output.innerHTML = this.value;}

      $("#myonoffswitch").click(function(){

                                          if ($("#dataplacer").data('dev_type') == 'False'){
                                                                                    $("#prendeapaga").toggle(500);}
                                          if ($("#myonoffswitch").val()=='On'){$("#myonoffswitch").val('Off');$("#statevalue").val('False');}
                                          else{$("#myonoffswitch").val('On');$("#statevalue").val('True');}

                                             });
      
      $(document).on("click","span.editdevice",function(){

                                                        var location = $(this).data('location');
                                                        var str_id = $(this).data('str_id');
                                                        var state = $(this).data('state');
                                                        var set_point = $(this).data('set_point');
                                                        var dev_type = $(this).data('dev_type');
                                                        $("#device_location").val(location);
                                                        $("#device_name").val(str_id);
                                                        $("#dataplacer").attr('data-dev_type',dev_type);

                                                          if (state == 'True'){
                                                          console.log('deberia');
                                                          if ($("#myonoffswitch").val()=='Off'){
                                                          $("#myonoffswitch").click();}
                                                          if (dev_type=="True") {$("#prendeapaga").attr("style","display:none;padding-left: 20px;");} else {
                                                          $("#myRange").val('param_set_point')
                                                          output.innerHTML = set_point;
                                                          $("#prendeapaga").attr("style","display:block;padding-left: 20px;"); }
                                                          //if ($("#prendeapaga").is(":hidden")) {$("#prendeapaga").toggle(500);}
                                                        }
                                                        else {if ($("#myonoffswitch").val()=='On'){
                                                          $("#myonoffswitch").click();
                                                        }}


        $('#modaleditdevice').modal('show');});
    </script>

    {% endblock %}